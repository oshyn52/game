\# Архитектура калькулятора



Версия 1.0 | Обновлено: 2024 г.



\## 1. Общая концепция



Данный калькулятор построен на основе \*\*паттерна "Интерпретатор" (Interpreter pattern)\*\* и \*\*конечного автомата (State Machine)\*\* для обработки ввода.



Основная цель архитектуры — отделить логику вычислений от способа отображения (Console/Web/Desktop).



\## 2. Слои архитектуры



\### Слой 1: Модели (Models)

\*Местоположение: `app/models/`\*



Содержит простые дата-классы (структуры), которые используются для передачи данных между слоями.

\- `Number` — обертка для числа (int/float) с проверкой на переполнение.

\- `Operator` — перечисление (Enum) действий: `ADD`, `SUBTRACT`, `MULTIPLY`, `DIVIDE`.

\- `Expression` — структура, содержащая левый операнд, правый операнд и оператор.



\### Слой 2: Ядро (Core)

\*Местоположение: `app/core/`\*



Сердце приложения. Этот слой не должен импортировать ничего из слоя UI.



\#### a) \*\*Калькулятор состояний (StatefulCalculator)\*\*

Реализует логику поочередного ввода (как в обычном карманном калькуляторе).

\- Состояния: `FIRST\_INPUT`, `SECOND\_INPUT`, `RESULT`.

\- Управляет текущим значением на дисплее.

\- Содержит метод `calculate(operator, a, b)`.



\#### b) \*\*Парсер выражений (ExpressionParser)\*\*

Преобразует строку типа `"2 + 2 \* 2"` в объект `Expression` (или AST — абстрактное синтаксическое дерево).

\- Учитывает приоритет операций (\* и / перед + и -).

\- Обрабатывает скобки.

\- Валидирует корректность строки.



\#### c) \*\*Исключения (exceptions.py)\*\*

Специфичные ошибки: `DivisionByZeroError`, `InvalidInputError`, `OverflowError`.



\### Слой 3: Интерфейсы (UI)

\*Местоположение: `app/ui/`\*



Содержит конкретные реализации пользовательского интерфейса.



\- \*\*Консольный интерфейс (cli.py):\*\* Читает `input()` и выводит результат.

\- \*\*GUI (gui.py):\*\* Окно с кнопками (Tkinter/PyQt).

\- \*\*Web (web.py):\*\* Контроллер для Flask/FastAPI.



Важно: UI только вызывает методы из \*\*Слоя ядра\*\*. В UI не должно быть вычислений.



\## 3. Схема взаимодействия (на примере консольного ввода)



```mermaid

graph TD

&nbsp;   A\[Пользователь вводит '3 + 5'] --> B(UI: Консоль);

&nbsp;   B --> C{Парсер};

&nbsp;   C --> D\[Expression(left=3, op=PLUS, right=5)];

&nbsp;   D --> E(Ядро: Калькулятор);

&nbsp;   E --> F\[Вычисление 3+5];

&nbsp;   F --> G(Результат: 8);

&nbsp;   G --> H(UI выводит '8');

